<ion-header>
  <ion-toolbar color="primary">
    <ion-title>To-Do List</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Formulario para agregar tarea -->
  <div class="task-form">
    <ion-item>
      <ion-input 
        [(ngModel)]="newTaskTitle" 
        placeholder="Nueva tarea"
        (keyup.enter)="addTask()"
      ></ion-input>
    </ion-item>
    <ion-item>
      <ion-select 
        [(ngModel)]="selectedCategory" 
        placeholder="Selecciona una categoría"
        interface="action-sheet"
      >
        <ion-select-option *ngFor="let cat of categories" [value]="cat.id">
          {{ cat.name }}
        </ion-select-option>
      </ion-select>
    </ion-item>
    <ion-button 
      expand="block" 
      color="primary"
      (click)="addTask()"
      [disabled]="!newTaskTitle.trim()"
    >
      Agregar Tarea
    </ion-button>
  </div>

  <!-- Lista de tareas - VERSIÓN SIMPLIFICADA -->
  <div class="task-list" *ngIf="tasks.length > 0; else emptyState">
    <ion-list>
      <!-- Debug info -->
      <ion-item>
        <ion-label color="primary">Total tareas: {{tasks.length}}</ion-label>
      </ion-item>
      
      <ion-item *ngFor="let task of tasks; trackBy: trackByTaskId">
        <ion-checkbox 
          slot="start"
          [(ngModel)]="task.completed" 
          (ionChange)="updateTask(task)"
        ></ion-checkbox>
        
        <ion-label [class.completed]="task.completed">
          {{ task.title }}
          <div *ngIf="task.category">
            <ion-badge color="secondary">
              {{ getCategoryName(task.category) }}
            </ion-badge>
          </div>
          <small>ID: {{task.id}}</small>
        </ion-label>
        
        <ion-button 
          slot="end"
          fill="clear" 
          color="danger"
          (click)="deleteTask(task.id)"
        >
          <ion-icon name="trash"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>
  </div>

  <!-- Mensaje cuando no hay tareas -->
  <ng-template #emptyState>
    <div class="empty-state">
      <ion-icon name="clipboard-outline" size="large"></ion-icon>
      <h3>No tienes tareas aún</h3>
      <p>Agrega tu primera tarea usando el formulario arriba</p>
    </div>
  </ng-template>
</ion-content>